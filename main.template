terraform {
  required_providers {
    proxmox = {
      source = "telmate/proxmox"
      version = "2.9.14"
    }
  }
}
  


provider "proxmox" {  
  pm_api_url = "https://pve.thejfk.ca/api2/json"    
  pm_api_token_id = "terraform@pam!main_terraform"    
  pm_api_token_secret = "b01b0155-c025-4b3a-b173-cb6b1bf9eb17"    
  pm_tls_insecure = false
}

resource "proxmox_lxc" "@@@vm_name" {
    count = @@@count
    features {
        nesting = true
        @@@nfs
    }
    hostname = var.vm_name
    network {
        name = "eth0"
        bridge = "vmbr0"
        gw = var.vm_gw  
        ip = var.vm_ip
        ip6 = "dhcp"
        @@@vlan
    }
    rootfs {
        storage = "ceph"
        size    = var.storage
    }
    ostemplate = "truenas-nfs:vztmpl/ubuntu-22.04-standard_22.04-1_amd64.tar.zst"
    password = var.password
    pool = var.vm_pool
    target_node = var.pve_node
    unprivileged = var.unpriv
    cores = var.cores
    memory = var.memory    
    vmid = var.vmid
    
    ssh_public_keys = 
        ssh-ed25519 b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZWQyNTUxOQAAACAEO+Qp38YjBnm4/+yEePgv+fQDEEjDklKHso4au2gzOAAAAKDH7uJLx+7iSwAAAAtzc2gtZWQyNTUxOQAAACAEO+Qp38YjBnm4/+yEePgv+fQDEEjDklKHso4au2gzOAAAAEA9CsyKpFzb9JJLCODL7QjQQ1nvY2xFHvFqIc+LU/kaNgQ75CnfxiMGebj/7IR4+C/59AMQSMOSUoeyjhq7aDM4AAAAGGtldmluLmEuYnJ1bmVyQGdtYWlsLmNvbQECAwQF kevin    
}

